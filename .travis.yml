stages:
- name: compile
- analysis
- test
#- sonarqube
- name: deploy
  if: branch = master
language: java
jdk:
- oraclejdk8
before_cache:
- rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
- rm -fr $HOME/.gradle/caches/*/plugin-resolution/
- rm -fr $HOME/.gradle/caches/*/scripts/
cache:
  directories:
  - "$HOME/.gradle/caches/"
  - "$HOME/.gradle/wrapper/"
  - "$HOME/.sonar/cache"
# overriding the install step is important to avoid that ./gradlew assemble is run (which is the default in travis)
install:
  - true
jobs:
  include:
  - stage: compile
    script:
    - "./gradlew build -x test"
  - stage: analysis
    addons:
      sonarcloud:
        organization: "starlibs"
    script:
    - ./gradlew compileJava
    - ./gradlew testClasses
    - ./gradlew sonarqube -x test
  - stage: deploy
    script: 
    - "./gradlew publish -PnexusBaseUrl=$nexusBaseUrl -PnexusUpRepo=$nexusUpRepo -PnexusUser=$nexusUser -PnexusPassword=$nexusPassword"
env:
  global:
  - secure: FkCxTnMbWP3Whd61puUXI6VJhhhXTeFby0k2Rmq01dYZN8asZ1FCoQFw1dEOlcx7dWLYFvb1feSmi7YOW+u6WznrbORu41NWFpA5VvGJyPkrsrhNN6xaNy7PNfFCMjmhZqcOAUoCCDwGzyUe17qoip1NfjNiIIFa+G6HNATUaODeGBtDBYpKVw3tvzM/rz14cIx2U4wF1WphxaIME3X5pzBNm0JK0NsYOZOHpb96O5t0lVkQXFgsm2A7Q0yWV+fGENoqfHZlnKmuiXjd7VJDNl9VMPjCLbcgVeN7O7OSzOQ9Omb9YwesV2nMUPEX6g2/v9yzFOoDpghtKEU9jZaLpIfmHsRafCNx0jBdy482cjznfEYaowT4CG/lGi4tT8gMYxzJGsT8TAdHoyzX7ZZUJsY+LWqb0K45YTup51Ynbuz2xeGzWo6Ydm9kYeuBcmcMwEjXFcSubalobT3JGlKUIgW9abEUfTWZwuhAzsRJ6uzB2N7pVqC/MyGXvnDJcQNDObHlmeKA0pWqZ9yIWYxHqByuwWfs+Ac63XJOk1qboWBfRXQhTWI9qQPV1W1j0kHU4S+MA2vPS1P7evzcU+Ci/YdCDwONiZ8Df1mevV3U8uZPmMcb5rgJ2YQT7xlSahTE1n7St8SroP6vFdiCgKuj8RRAIn9IZM6uTBAN1dKyDxQ=
  - secure: n7jixa2lZTul+vGQWKrgTPDZTBXyEGyNzznVxy2ljGNFRdbX7js11tLJiGV0F5yUtD+2tHRsFyMxiauIfajW3A2y6EdCJvCbWXU1gtzN1khufk4bTujnomEiqERI16wbiIwTaVWILnX+m0mmw14qj8+9FJpsudzQuAdyy2a6qKM/3cn9VNJN1KAOye0liRV+cFlwVstwynZXFg6xRJ6PyJMQBorZyP6XVTQYpwqe7iKtR2jI6iVlQdLhjZAspDaG7QC4RA5Sxv0+a10cs6T3AZyddHrJi7AqrtSVfIO1Spq/hr/jtG//rmFZKmtoXIg1J2qIrDmhNN6G7d3StO8QecNYs+5GR4gHGMEkY86Op22g4nL+ktACviWpY7nRrgSKMef8fJ3BMfJriwMOBgVNBIoj7POFwRUWJ78pGGusIyHWsmd07OfqyQbvImkcFfGZBCUZugCVWoKpxJW5TeWu073AuBT9gMbDTnvcE3S2l1YZGxryJl0o5w9u3HM94ERqY77HVGa9LKzcZSPXyLfeqWQt1O1YaGmxE+vYtFokwQr9TI3pEbQy4Kq6U8PoLGpilhUAXkxM+Dmaia2b2seUfNbeAnvl4R0IFVY/KhpucJDz2z8lKR143ppudSsTYLOVk1+cAGwqBm72EdNu1NIM+3MM4vViZj0N0bQ6gr2d1gw=
  - secure: uruOwgB6s3zHxvBGO5rAKr8w2vihnJr56ZtuG1e/uUznQAuWPD/Tfa+7dNXMiLEAERY+IzOH1ZNohCPv/BN492POV+elz9O6J28BpQbuR1sTz2vh4PRHjJxWvXp5JYQpSoH2GRn+r21PfE6viFkD3FoyQYYQY7TDSqbPtMWTxp/EqPbnXbGC9i/Ej2hCjTa0c8TkadYxYR/qPNr2FghrSudtm8xF48UNGGHGGKcVisRpUMjAawyIY6luc6SfKeD3VSi7+ruYL30P+1bzcp/2W+cR3uNp/Kl8WMrPSjbRLGcy7/rYC5pXvxmpcNjkrj7CRDNnlnprZOeqsWUGq0g/oNLv+w98A+VDFRvs0DLAk5qX1Fj8/aSAjlCCTRBrjY34b6CJOikKNQOpM1kwi1tx2ER/yfx97PA+p9Hd15IWvzUTGef6zGW4vfeFnpgiwEMk3Z3XEJ7XYIChgk/1QrjhjBXihbbDQ5Ifl8rUwNQahbxHDiXlqBFd7v2RxfoqXoWFkC9bbL0yRgrKvcb/kC8A5/+ih7wFoz0f7Djw09eGdf67EKuc/aaY4zY8s1UFN33M9NuPIhqiNbF8rSf40xb077LYgeOXRwdZq/f/3Ay3NBonSDpyYFfMobcXA1YCexm68jeiBLjWehkFrxlmDdhQpiCL/QsbPl4+7cNFsjdwJFU=
  - secure: beYMt3rl3NMfQNvYfYwObyQxMmaPqzgQ6UkNDjc3/aM6dEVo+m6C1dM4qy298iRt5052IZmCRl6lbUtFsdWVt0gUYorMUWchgnLHocOykdNylQtIZRKzXcvL+IxXoX6hjTu+9NsdTOmbTu51vFJ7l3w8BbqoZxuyR45NwUcC4LLb69AlFsEps/n0Rz43YJgG878mLvaLhIo2KjDSCF5cEf7U8gfm8YdcAbQxTJ82SYq4bV/+Nn1ObNXV2efT7dgqUDfFufBb2KGq8+WHZkR2Rkg17Xc0OaxYmMsy2ffOOqSE/XefGaynBSXUMjhkurODfQJam+eZenSNO6TBwXFBe/rjictMQDeGs0vd1gOQAyUluttV4n8K4RIIuDlYGCH/095A6U2Ss2qTiKoEM4oJ8OGr5z7PQe1j+jaP6G7Pm4Zsq4L0FFDXGNOYCObMotXF0ks2hhkz9pSHHShJBqdVHHcqEeKNzhw34NEnByDnjwA3DjLNXqtXciIcK6PyQMS8m0vubdpVs6qpNAuUNjy3OiO4hix2IiiAVnPcgzdH5kfUr0T1JdbPEWqT40IOZ3/NcfYcss4ftVgwFjGizRBkiDu/TXifVRK3DkTfElOYuqCp/LRwsgwHwYZuvGK3H1KAEVWLsnzEcnWbOu4gUBG9QqDTFlH3fi8gqHBnSRCgqUU=
  - secure: Mq2QjNnwnYGToCbeSnFi065p1CsQUo7M/ueLNBsI1B6z4oZVHD38Yg3wPBhIdYbJ+dW08liFAvLNnrHDA6xqX/+H6vewCkgCNw5C1C62dvKB/S9fkQ5JPYYm3VeYxfG4rYkEy121ZlMpZtQSP8wq89xZYcseY5lJDJmOZiQh5HZxs1Hc6vXNSpRj5JoeHgM5Ko8Db+sFpugbj+CNHhqYy171VhjoxtykXm/E4KWwfwjMyYE7VOiOKt7vudljA6PoRIWgKrNFUFEFHApAkrIkj5JKgFccuumoBvluXEycr6LxMJxWsU9HPi5OnNr2SIwEnZwDOywbnnTKONUf+ppXp0bG0wRleBPSAvOgJhoCDy3LD0TIE505QanHpEqUz0DzBQ8gqDpZlF7NdO5sL7ywKuSenICsPRr5Pahd4puwEocPqT2BWMD4AglUANBklXxwHJ66/SJBdXt3YAoepHSwgy86NGAbqv5MZBZweuvfeeWveHSbx3SnPOl2PyomMSgQlsaK33oByBsJxEPmyCIVZqVR5FzFU7N3BN4u3XLCWPmiUp5DKfA+NgVd1DnvkPRzvnB9atzSYy/lwYB9nBDmXsrI7c1vd8O0pDtXliHOu4Dy+RGLUR3PkmIK5TpptD+yuDrh7AykjY53pLe28PyYslImj09CBPpggkHvU4fG4Ug=
  #- secure: DfzFY0ZPQljDuzACprKbH0i3WwyzE0Mu17wqVZHNrhldOnjnmS+aM6NxRy5pDYMFKLV2I/sWn2+VH3VxswvEq4VAH/m61F2HSuA5UolFCaL6QYszHn9sOkJt/kVe+mI08iy/b6RJF3l8p73oiOeTu+Nx8sVL2DftfmG0NsG0ie2vaMtGKUFEG1ooE2iNUj1FjcjDBzxQ06p2XGbsVeFwoJo/Y+WbHXPOdzE2m7dXmbERrM4yRMQ9RR56qdsCgaJQuPZqcbd9v71GEPZ8FGN6t7evojK0P9TM0pdiJeptD3QErP3YE6YAFy+mDU4W9nycazFowAyg45o9G+60Aob4WI3fDsSb5duZ6tO1EzYrvjuH9gvucYmu8+DXAzXgF2MvebtrtZTlyPviuyRpcp2EtZmG4evyFeRRAnXV07nYSN7chb0bsF02d23UW2NQYPtQvl+YUIbTYgfwB6rjpWQtNxLMu8s6QMdnuVwpJWevTACW1ryJZyJExLhnPJp2/bnoB94sebr4kSezUX/CMi+jVxTQ+BdlqWKafjYDfBQ+T7m7Mfs5beBC0+7m7gpqLgDhDx2kngWTrwDAGwCnqTGo1Zf1M7ZqbwYxO6UVcNMB4JgBfAGfK1HMOt5EU6UPFCqUnn5bOqFCOwJagpnm7FnWYOJR3kTlzXapJs9U/DJ84Ro=
  #- secure: LkTxOQQ5d4OKT6Vq+4LAJpBhnJ2/ymJOVHDYDayuKmmExq+fOot11xpDrUZ/Ju3RJqPRrVGVA1C5xheWaWVjeAa1LLIJugw4jW9HesXx4sKeW3jpG13Tn/YEP18pr7YxrSp0Q7xqPcDjth1mxM0ovTpZ1iLGJawGUre0amMZOT3dwKfFRZNfXiQL7Uog6xQ6Z+QhkSaBS3IMT+wCM2Yrrn9oXNDZY7KhZ533AhPgaQI9A3O5Zpp4ag7O+zXg3cru7ANb5ViRxz3AK3pwL//ZPq88Lby6AOb5vzsQnSU/Lsjq7i7CYhsl2EXSUT3dFr94yMERiAibMvU5Y1z4cipTf8WYVo7RL278ju8i20WWCaARuGWcieve14k1b5iOQS3jl+Z1YPL0htbByPeyZNH9yDta1QAGdOl+p+Tz0FNXOviQwA7k9NIjc1Qr/F18sntLEcfUW9oHE61bxAFjuZSRCNvBe6wPB/vSQ747ARi8cNzsBuyE8rEgHm1Bn4VJ15iA2Le5o0awtglJDaTnZNA33hepyx7+YGGagPe/+2dgWyIh9bsFxly5gCFsJIG9HwaJmh1dShCk8jXEy+nCB+Es33sMyxP9CaphB/HWAfzsohpfrBoqwB2Pn4Gpxc85k70TDJ7vQkacneZY3nfTH45oSvgeQKmyhE8pijhazdCfBmc=
  - secure: yUfjJ5ZSdOWWYLye5Oc6LnkN8fRFHOvRM/NlH15NXN5ZloRqfsfcQ80TFUBOCkEBwGPwUqhqZn2x7yc6XzVlpZ0lNc8voDvDNvGk2V0R42QOHUPFce0HicAtslM6we05kWA3wmcKvB3nBhRC1rPcrZC3a0G2Vby8yfvO2BEEog7Cb8zhaX5RcOFedSw3pgDrnu/aglZ2mtOjhyt36aYXx7UGY9ueEO24EcF0R8XKNn8h7qSnr7GJtPLioTME4gCOhV57YBBgDbM72I33Rmmr1fvb264/QTozYh5E0e+0uv5BuQO8q4XZU5VjdG+eTISbtkXc3bFSAOeVYUrXJBv7t7C/IhuiaHFRSC8O9dME8MXfaa/0E199CgmI7M23LIjKF7r3gPz6VvBx9BBs3m7zgCnwBhomw8ggk1U21GDYR5AwoaGhYpBCFfdMNPnPiS8vpoXYk9L1dl8vyGRyVLBNpAq7wXthWrUz3X3HEEMVWDyRqnugDzS+lE/hB+Mh7TA+lqVJegRcNOyjHw/JdynEbbvatRXOZQftcgQ4FZ81dUjI+Svin79WCdCSGM8fcTTIB5+/avoggAyLwQpsX5BXewEhADdwl5OcsFiYBPZLbX0gUBtbIKCsEOxUMX55VbzdiLoWOFMjjqUeyXJteGdqVKcFIyEazJ/Eh07lc78SxqE=
